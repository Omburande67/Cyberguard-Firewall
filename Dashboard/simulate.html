<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>CyberGuard ‚Äî Attack Simulator</title>
<style>
  body{background:#061018;color:#dff5ff;font-family:Inter,Arial;padding:24px}
  .box{max-width:620px;margin:auto;background:rgba(255,255,255,0.03);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
  input,select,textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:white}
  button{background:#00e1ff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700;color:#001b20}
  .error{color:#ff6b6b;font-size:12px;margin-top:-5px;margin-bottom:10px;display:none;}
  .error.show{display:block;}
  input.invalid, textarea.invalid{border:1px solid #ff6b6b;}
  input.valid, textarea.valid{border:1px solid #34ff9b;}
</style>
</head>
<body>
<div class="box">
  <h2>Attack Simulator</h2>

  <input id="src" placeholder="Source IP (e.g. 192.168.1.1)" maxlength="15">
  <div id="srcError" class="error">Please enter a valid IP address (e.g. 192.168.1.1)</div>

  <input id="path" placeholder="Target Path (e.g. /login)" maxlength="100">
  <div id="pathError" class="error">Path must start with / and contain only letters, numbers, and -_./</div>

  <textarea id="payload" rows="3" placeholder="Payload (e.g. username=admin)" maxlength="500"></textarea>
  <div id="payloadError" class="error">Payload contains invalid characters or is too long (max 500 chars)</div>

  <select id="severity">
    <option value="low">low</option>
    <option value="medium">medium</option>
    <option value="high">high</option>
  </select>

  <button onclick="send()">Send Attack</button>
  <p id="status" style="color:#aee"></p>
</div>

<script>
// Validation functions
function isValidIP(ip) {
  if (!ip) return false;

  const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
  if (!ipRegex.test(ip)) return false;

  const parts = ip.split('.');
  return parts.every(part => {
    const num = parseInt(part, 10);
    return num >= 0 && num <= 255 && part === num.toString();
  });
}

function isValidPath(path) {
  if (!path) return false;

  const pathRegex = /^\/[a-zA-Z0-9\-_\.\/]*$/;
  return pathRegex.test(path) && path.length <= 100;
}

function isValidPayload(payload) {
  if (!payload) return false;

  const dangerousChars = /[<>\"'`\\\x00-\x1f\x7f]/;

  return !dangerousChars.test(payload) && payload.length <= 500;
}

// Real-time validation
document.getElementById('src').addEventListener('input', function(e) {
  const ip = e.target.value;
  const errorElement = document.getElementById('srcError');

  if (!ip) {
    e.target.classList.remove('valid', 'invalid');
    errorElement.classList.remove('show');
  } else if (isValidIP(ip)) {
    e.target.classList.add('valid');
    e.target.classList.remove('invalid');
    errorElement.classList.remove('show');
  } else {
    e.target.classList.add('invalid');
    e.target.classList.remove('valid');
    errorElement.classList.add('show');
  }
});

document.getElementById('path').addEventListener('input', function(e) {
  const path = e.target.value;
  const errorElement = document.getElementById('pathError');

  if (!path) {
    e.target.classList.remove('valid', 'invalid');
    errorElement.classList.remove('show');
  } else if (isValidPath(path)) {
    e.target.classList.add('valid');
    e.target.classList.remove('invalid');
    errorElement.classList.remove('show');
  } else {
    e.target.classList.add('invalid');
    e.target.classList.remove('valid');
    errorElement.classList.add('show');
  }
});

document.getElementById('payload').addEventListener('input', function(e) {
  const payload = e.target.value;
  const errorElement = document.getElementById('payloadError');

  if (!payload) {
    e.target.classList.remove('valid', 'invalid');
    errorElement.classList.remove('show');
  } else if (isValidPayload(payload)) {
    e.target.classList.add('valid');
    e.target.classList.remove('invalid');
    errorElement.classList.remove('show');
  } else {
    e.target.classList.add('invalid');
    e.target.classList.remove('valid');
    errorElement.classList.add('show');
  }
});

// Main send function with validation
async function send(){
  const source_ip = document.getElementById('src').value.trim() || '192.168.1.1';
  const path = document.getElementById('path').value.trim() || '/test';
  const payload = document.getElementById('payload').value.trim() || 'test_payload';
  const severity = document.getElementById('severity').value;

  let hasErrors = false;

  if (!isValidIP(source_ip)) {
    document.getElementById('srcError').classList.add('show');
    document.getElementById('src').classList.add('invalid');
    hasErrors = true;
  }

  if (!isValidPath(path)) {
    document.getElementById('pathError').classList.add('show');
    document.getElementById('path').classList.add('invalid');
    hasErrors = true;
  }

  if (!isValidPayload(payload)) {
    document.getElementById('payloadError').classList.add('show');
    document.getElementById('payload').classList.add('invalid');
    hasErrors = true;
  }

  if (hasErrors) {
    document.getElementById('status').innerText = '‚ùå Please fix the errors above before sending';
    document.getElementById('status').style.color = '#ff6b6b';
    return;
  }

  const body = {
    source_ip: source_ip,
    path: path,
    payload: payload,
    severity: severity
  };

  document.getElementById('status').innerText = 'Sending...';
  document.getElementById('status').style.color = '#aee';

  try {
    const res = await fetch('/attack', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(body)
    });

    const data = await res.json();

    if (data.received) {
      let statusMessage = `‚úÖ Sent successfully! `;
      statusMessage += `Severity: ${data.attack.severity.toUpperCase()} `;
      if (data.attack.detected_patterns && data.attack.detected_patterns.length > 0) {
        statusMessage += `| Patterns: ${data.attack.detected_patterns.join(', ')}`;
      }
      if (data.attack.blocked) {
        statusMessage += ` | üö´ BLOCKED`;
      }

      document.getElementById('status').innerText = statusMessage;
      document.getElementById('status').style.color = '#34ff9b';
    }

  } catch(err) {
    document.getElementById('status').innerText = '‚ùå Error: ' + err;
    document.getElementById('status').style.color = '#ff6b6b';
  }
}

// Enter key support
document.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    send();
  }
});
</script>
</body>
</html>
